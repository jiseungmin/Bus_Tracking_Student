<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden; /* 스크롤바 추가 방지 */
      height: 100%; /* 페이지의 전체 높이를 사용하도록 보장 */
    }
  
    #map_div {
      width: 100%;
      height: 100%;
    }
  </style>
  <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=9syZeMdaYD79paz4xmvSpYa8AOxVgRxay0YUQWR5"></script>
  <script type="text/javascript">
    var map;
    var currentMarker = null;

    function initTmap() {
      map = new Tmapv2.Map("map_div", {
        center: new Tmapv2.LatLng(36.8002, 127.0715),
        width: "100%",
        height: "100%",
        zoom: 16,
      });

      // 천안터미널 경로
      var coordinates = [
        new Tmapv2.LatLng(36.8002, 127.0715),
        new Tmapv2.LatLng(36.80021, 127.0709),
        new Tmapv2.LatLng(36.79942, 127.0718),
        new Tmapv2.LatLng(36.79807, 127.0718),
        new Tmapv2.LatLng(36.79804, 127.078),
        new Tmapv2.LatLng(36.79764, 127.079),
        new Tmapv2.LatLng(36.79776, 127.0801),
        new Tmapv2.LatLng(36.7975, 127.0861),
        new Tmapv2.LatLng(36.80026, 127.0857),
        new Tmapv2.LatLng(36.80039, 127.0868),
        new Tmapv2.LatLng(36.79579, 127.0876),
        new Tmapv2.LatLng(36.79897, 127.0939),
        new Tmapv2.LatLng(36.80006, 127.0973),
        new Tmapv2.LatLng(36.80161, 127.1054),
        new Tmapv2.LatLng(36.82273, 127.1119),
        new Tmapv2.LatLng(36.82287, 127.1182),
        new Tmapv2.LatLng(36.82364, 127.1239),
        new Tmapv2.LatLng(36.82642, 127.1329),
        new Tmapv2.LatLng(36.82477, 127.1529),
        new Tmapv2.LatLng(36.82472, 127.1592),
        new Tmapv2.LatLng(36.82402, 127.1604),
        new Tmapv2.LatLng(36.82127, 127.1624),
        new Tmapv2.LatLng(36.81895, 127.1584),
        new Tmapv2.LatLng(36.81887, 127.1535),
      ];

      new Tmapv2.Polyline({
        path: coordinates,
        strokeColor: "#FF0000",
        strokeWeight: 5,
        map: map,
      });
    }

    function addMarker(latitude, longitude) {
      var marker = new Tmapv2.Marker({
        position: new Tmapv2.LatLng(latitude, longitude),
        map: map
      });
    }

    function addBusMarkers(buses) {
      buses.forEach(bus => {
        addMarker(bus.latitude, bus.longitude);
      });
    }


    window.addEventListener("message", function (event) {
      try {
        var data = JSON.parse(event.data);
        if (data.buses) {
        map.setCenter(new Tmapv2.LatLng(data.User_latitude, data.User_longitude));
        addBusMarkers(data.buses);
      }
        var User_latitude = data.User_latitude;
        var User_longitude = data.User_longitude;

        if (currentMarker) {
          currentMarker.setMap(null);
          currentMarker = null;
        }

        var moveLatLng = new Tmapv2.LatLng(User_latitude, User_longitude);
        map.setCenter(moveLatLng);
      } catch (error) {
        window.ReactNativeWebView.postMessage(
          "error: parsing message from React Native"
        );
        console.error("Error parsing message from React Native:", error);
      }
    });
  </script>
</head>
<body onload="initTmap()">
  <div id="map_div"></div>
</body>
</html>
